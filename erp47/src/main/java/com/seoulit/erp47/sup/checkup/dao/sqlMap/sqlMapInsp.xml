<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.seoulit.erp47.sup.checkup.dao.InspDAO">
	<cache eviction="LRU" flushInterval="86400000"/>
	<!-- 종합검진 검사관리  - 검사목록 조회 -->
	<select resultType="InspBean" useCache="true" flushCache="false" id="selectInspList"> 
		SELECT PCK_CD, I.INSP_CD, INSP_NM, OCS_CD, E.EMR_NM AS OCS_NM, RSLT_DEPT_CD, 
		FN_CM_CODENAME('SC036',RSLT_DEPT_CD) AS RSLT_DEPT_NM, OCS_DIV_CD, AMT, USE_YN 
		FROM SC_PCK_INSP P, SC_INSP I, SC_EMR_CODE E 
		WHERE P.PCK_CD = #{pckCd} 
		AND P.INSP_CD = I.INSP_CD 
		AND I.OCS_CD = E.EMR_CD 
	</select>
	
	<!-- 종합검진 검사관리  - 선택 검사목록 조회 -->
	<select resultType="ChoInspBean" useCache="true" flushCache="false" id="selectChoInspList"> 
		SELECT CI.RSVT_NO, CI.INSP_CD, I.INSP_NM, CI.QNT, CI.AMT, CI.INSP_PLN_DATE, CI.REG_ID, CI.REG_IP, CI.REG_DATE
		FROM SC_CHO_INSP CI, SC_INSP I
		WHERE CI.INSP_CD=I.INSP_CD
		AND RSVT_NO = #{rsvtNo}
	</select>
	
	<!-- 종합검진 검사관리  - 선택 검사목록외 조회 -->
	<select resultType="InspBean" useCache="true" flushCache="false" id="selectExChoInspList"> 
		SELECT I.INSP_CD, I.INSP_NM, I.OCS_CD,E.EMR_NM AS OCS_NM, AMT, I.RSLT_DEPT_CD, USE_YN, OCS_DIV_CD, FN_CM_CODENAME('SC036',I.RSLT_DEPT_CD) 
      	FROM SC_INSP I,SC_EMR_CODE E  
      	WHERE INSP_CD NOT IN(SELECT INSP_CD FROM SC_CHO_INSP WHERE RSVT_NO = #{rsvtNo})
      	AND I.OCS_CD = E.EMR_CD
      	AND I.USE_YN = #{useYn}
	</select>
	
	<!-- 종합검진 검사관리 - 수정, 등록, 저장 -->
	<update id="insertChoInsp"> 
		MERGE INTO SC_CHO_INSP USING DUAL ON (RSVT_NO = #{rsvtNo} AND INSP_CD = #{inspCd}) WHEN NOT MATCHED THEN INSERT ( RSVT_NO, INSP_CD, QNT, AMT, INSP_PLN_DATE ) VALUES ( #{rsvtNo}, #{inspCd}, #{qnt}, #{amt}, #{inspPlnDate} ) 
	</update>

	<delete id="deleteChoInsp"> 
		DELETE FROM SC_CHO_INSP WHERE RSVT_NO =#{rsvtNo} AND INSP_CD =#{inspCd} 
	</delete>

	<update id="updateChoInsp"> 
		UPDATE SC_CHO_INSP SET QNT =#{qnt}, AMT =#{amt}, INSP_PLN_DATE = #{inspPlnDate} WHERE RSVT_NO = #{rsvtNo} AND INSP_CD = #{inspCd} 
	</update>

</mapper>
		